# 📚 Novel AI Agent

一个支持角色设定、剧情连贯、上下文记忆与互动写作的 AI 小说创作平台。

---

## 🎯 项目目标

构建一个基于大语言模型（LLM）的小说 AI Agent，支持用户输入角色和设定，AI 能够进行长期上下文保持、风格稳定的文本生成，协助用户创作小说作品，包括但不限于章节写作、人物互动、剧情推进与润色改写。

---

## 🧩 项目功能（预期）

### ✅ 基础功能（MVP）
- 小说章节生成：根据用户设定生成长篇文本
- 多角色支持：支持多个角色互动对话
- 人设面板：用户可设定人物性格、背景、口癖等
- 剧情摘要/大纲生成：AI 自动生成或协助撰写故事大纲
- 上下文记忆：支持长篇连贯生成，保留关键剧情和人物设定
- Prompt 模板系统：不同任务使用不同提示词模板，提升一致性

### 🌟 进阶功能（V1.1+）
- 向量检索记忆系统（角色/事件/剧情）
- 生成质量控制（语调一致、事件不打架、性格不漂移）
- 润色与改写工具：AI 优化用户写作内容
- 小说结构可视化（章节树、角色关系图）
- 用户作品管理：保存草稿、导出项目、加载创作档案

---

## ⚠️ 核心技术难点

| 类别 | 问题 | 描述 |
|------|------|------|
| 上下文保持 | 长文本 token 限制 | LLM 在生成长篇内容时容易丢失前文信息 |
| 角色一致性 | 性格、口癖漂移 | 多角色容易出现语气混乱、设定冲突 |
| 记忆机制 | 内容无法回溯 | 模型无法“记得”前几章角色经历、事件发展 |
| Prompt 不稳定 | 模板无法泛化 | 用户设定差异大，模型输出质量波动 |
| 成本控制 | API Token 费用 | 长文本生成成本高，需要平衡调用频率 |

---

## 🧠 技术解决方案概览

### 🔹 上下文保持机制
- 使用分层上下文结构：
  - 角色设定（静态）
  - 世界观设定（静态）
  - 剧情摘要（中期）
  - 当前场景上下文（短期）
- 自动生成摘要 + 场景标签，控制 token 占用

### 🔹 向量记忆系统
- 向量数据库（如 Pinecone / FAISS）存储段落摘要、角色事件
- 使用嵌入模型生成语义向量，支持关键词、语义回忆

### 🔹 Prompt 模板系统
- 分任务构建提示词模板（如：续写、对话生成、润色）
- 结构化注入设定/摘要/对话历史，提升稳定性

### 🔹 小说结构管理
- 每章/段落单独保存，支持大纲导航、片段预览
- 用户项目支持多存档、导入导出

---

## 🔧 技术栈

| 模块 | 技术 |
|------|------|
| 前端 | React (Next.js), Tailwind CSS, ShadCN UI, TipTap 编辑器 |
| 后端 | Python (FastAPI) / TypeScript (NestJS) |
| LLM 接入 | OpenAI GPT-4o / Claude / Local Llama 3 |
| 嵌入与检索 | OpenAI Embeddings / FAISS / Pinecone |
| 数据存储 | PostgreSQL (小说数据)、Redis (上下文缓存) |
| 文件存储 | Supabase / S3 / 本地导出 |
| 部署 | Vercel / Railway / Docker |

---

## 📅 项目阶段规划

| 阶段 | 目标 | 说明 |
|------|------|------|
| ✅ 阶段 1 - 原型验证 | 样例角色 + Prompt 调用 + 基本生成 | 使用 GPT-4o 进行章节生成，用户设定角色 |
| ⏳ 阶段 2 - 记忆机制接入 | 向量存储 + 上下文压缩 | 使用 FAISS 检索历史摘要，注入 Prompt |
| ⏳ 阶段 3 - 编辑器集成 | 富文本编辑器 + UI 调整 | 实现多角色面板、章节管理等功能 |
| 🔜 阶段 4 - 用户系统 | 作品存档、导入导出、登录功能 | 支持多项目、草稿管理 |
| 🔜 阶段 5 - 风格控制与润色 | 支持风格选项、自动改写 | 模拟金庸、东野圭吾等风格；一键优化内容 |

---
